apiVersion: "acid.zalan.do/v1"
kind: postgresql
metadata:
  name: techlog-pg
  namespace: postgres-system
spec:
  teamId: choigonyok
  volume:
    size: 30G
    storageClass: ceph-block
  numberOfInstances: 3
  users:
    choigonyok:
    - superuser
  databases:
    techlog_db: choigonyok
  enableMasterLoadBalancer: false
  enableReplicaLoadBalancer: false
  postgresql:
    version: "16"
  resources:
    requests:
      cpu: 10m
      memory: 100Mi
    limits:
      cpu: 300m
      memory: 500Mi
  nodeAffinity:
    requiredDuringSchedulingIgnoredDuringExecution:
      nodeSelectorTerms:
        - matchExpressions:
            - key: node-type
              operator: In
              values:
                - worker
  patroni:
    failsafe_mode: false
    initdb:
      encoding: "UTF8"
      locale: "en_US.UTF-8"
      data-checksums: "true"
    pg_hba:
      - local all all trust
      - hostssl all +zalandos 127.0.0.1/32 pam
      - host all all 127.0.0.1/32 md5
      - hostssl all +zalandos ::1/128 pam
      - host all all ::1/128 md5
      - local replication standby trust
      - hostssl replication standby all md5
      - hostnossl all all all md5
      - hostssl all +zalandos all pam
      - hostssl all all all md5